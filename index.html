<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LeadForge AI - Intelligent Lead Generation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;500;600;700;800&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-void: #050508;
      --bg-deep: #0a0a0f;
      --bg-surface: #12121a;
      --bg-elevated: #1a1a24;
      --bg-hover: #22222e;
      --border-subtle: rgba(255,255,255,0.06);
      --border-medium: rgba(255,255,255,0.1);
      --text-primary: #f0f0f5;
      --text-secondary: #8888a0;
      --text-muted: #55556a;
      --accent-primary: #00e5ff;
      --accent-secondary: #7c3aed;
      --accent-tertiary: #10b981;
      --accent-warning: #f59e0b;
      --accent-danger: #ef4444;
      --glow-primary: rgba(0, 229, 255, 0.15);
      --glow-secondary: rgba(124, 58, 237, 0.15);
      --gradient-primary: linear-gradient(135deg, #00e5ff 0%, #7c3aed 100%);
      --gradient-mesh: radial-gradient(at 20% 30%, rgba(0, 229, 255, 0.08) 0%, transparent 50%),
                       radial-gradient(at 80% 70%, rgba(124, 58, 237, 0.08) 0%, transparent 50%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-void);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.6;
    }

    /* Neural Grid Background */
    .neural-grid {
      position: fixed;
      inset: 0;
      background-image:
        linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 60px 60px;
      pointer-events: none;
      z-index: 0;
    }

    .neural-grid::after {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--gradient-mesh);
      animation: meshPulse 20s ease-in-out infinite;
    }

    @keyframes meshPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* Floating Particles */
    .particles {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1;
      overflow: hidden;
    }

    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--accent-primary);
      border-radius: 50%;
      opacity: 0.4;
      animation: float 15s infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(100vh) scale(0); opacity: 0; }
      10% { opacity: 0.6; }
      90% { opacity: 0.6; }
      100% { transform: translateY(-100vh) scale(1); opacity: 0; }
    }

    /* Page Sections */
    .page {
      display: none;
      min-height: 100vh;
      position: relative;
      z-index: 10;
    }

    .page.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Navigation */
    .nav {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      padding: 20px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(5, 5, 8, 0.8);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-subtle);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
    }

    .logo-mark {
      width: 40px;
      height: 40px;
      background: var(--gradient-primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Space Mono', monospace;
      font-weight: 700;
      font-size: 16px;
      color: var(--bg-void);
      position: relative;
      overflow: hidden;
    }

    .logo-mark::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.3) 50%, transparent 70%);
      transform: translateX(-100%);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      100% { transform: translateX(100%); }
    }

    .logo-text {
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 22px;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .nav-links {
      display: flex;
      align-items: center;
      gap: 32px;
    }

    .nav-link {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      text-decoration: none;
      transition: color 0.2s;
      cursor: pointer;
    }

    .nav-link:hover {
      color: var(--text-primary);
    }

    .nav-actions {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-secondary);
    }

    .btn-ghost:hover {
      color: var(--text-primary);
      background: var(--bg-hover);
    }

    .btn-outline {
      background: transparent;
      color: var(--text-primary);
      border: 1px solid var(--border-medium);
    }

    .btn-outline:hover {
      background: var(--bg-hover);
      border-color: var(--accent-primary);
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: var(--bg-void);
      font-weight: 700;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 30px var(--glow-primary);
    }

    .btn-secondary {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border-medium);
    }

    .btn-secondary:hover {
      background: var(--bg-hover);
    }

    .btn-lg {
      padding: 16px 32px;
      font-size: 16px;
      border-radius: 10px;
    }

    .btn-sm {
      padding: 8px 16px;
      font-size: 13px;
    }

    .btn-mini {
      padding: 6px 12px;
      font-size: 11px;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .btn-mini.btn-primary {
      background: var(--gradient-primary);
      color: var(--bg-void);
    }

    .btn-mini.btn-outline {
      background: transparent;
      color: var(--accent-primary);
      border: 1px solid var(--accent-primary);
    }

    .btn-mini.btn-outline:hover {
      background: var(--accent-primary);
      color: var(--bg-void);
    }

    .btn-mini:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      border-radius: 8px;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn.loading {
      position: relative;
      color: transparent !important;
    }

    .btn.loading::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      border: 2px solid currentColor;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    .btn-primary.loading::after {
      border-color: var(--bg-void);
      border-top-color: transparent;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* ===== LANDING PAGE ===== */
    .hero {
      padding: 160px 40px 100px;
      max-width: 1400px;
      margin: 0 auto;
      text-align: center;
    }

    .hero-badge {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--bg-surface);
      border: 1px solid var(--border-medium);
      border-radius: 100px;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 32px;
    }

    .hero-badge-dot {
      width: 6px;
      height: 6px;
      background: var(--accent-tertiary);
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.5; transform: scale(1.2); }
    }

    .hero h1 {
      font-family: 'Syne', sans-serif;
      font-size: clamp(48px, 8vw, 80px);
      font-weight: 800;
      line-height: 1.05;
      margin-bottom: 24px;
      letter-spacing: -2px;
    }

    .hero h1 .gradient {
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .hero-subtitle {
      font-size: 20px;
      color: var(--text-secondary);
      max-width: 600px;
      margin: 0 auto 48px;
      line-height: 1.7;
    }

    .hero-cta {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .hero-stats {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 60px;
      margin-top: 80px;
      padding-top: 60px;
      border-top: 1px solid var(--border-subtle);
    }

    .hero-stat {
      text-align: center;
    }

    .hero-stat-value {
      font-family: 'Space Mono', monospace;
      font-size: 36px;
      font-weight: 700;
      color: var(--accent-primary);
    }

    .hero-stat-label {
      font-size: 14px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Features Section */
    .features {
      padding: 100px 40px;
      max-width: 1400px;
      margin: 0 auto;
    }

    .section-header {
      text-align: center;
      margin-bottom: 60px;
    }

    .section-label {
      font-family: 'Space Mono', monospace;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: var(--accent-primary);
      margin-bottom: 16px;
    }

    .section-title {
      font-family: 'Syne', sans-serif;
      font-size: 42px;
      font-weight: 700;
      margin-bottom: 16px;
    }

    .section-subtitle {
      font-size: 18px;
      color: var(--text-secondary);
      max-width: 500px;
      margin: 0 auto;
    }

    .features-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px;
    }

    .feature-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 32px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .feature-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--gradient-primary);
      opacity: 0;
      transition: opacity 0.3s;
    }

    .feature-card:hover {
      border-color: var(--border-medium);
      transform: translateY(-4px);
    }

    .feature-card:hover::before {
      opacity: 1;
    }

    .feature-icon {
      width: 48px;
      height: 48px;
      background: var(--bg-elevated);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      margin-bottom: 20px;
    }

    .feature-card h3 {
      font-family: 'Syne', sans-serif;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 12px;
    }

    .feature-card p {
      font-size: 15px;
      color: var(--text-secondary);
      line-height: 1.7;
    }

    /* Pricing Section */
    .pricing {
      padding: 100px 40px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .pricing-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      align-items: start;
    }

    .pricing-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      padding: 40px;
      position: relative;
    }

    .pricing-card.featured {
      background: var(--bg-elevated);
      border-color: var(--accent-primary);
      transform: scale(1.05);
    }

    .pricing-card.featured::before {
      content: 'Most Popular';
      position: absolute;
      top: -12px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--gradient-primary);
      color: var(--bg-void);
      font-size: 12px;
      font-weight: 700;
      padding: 6px 16px;
      border-radius: 100px;
    }

    .pricing-name {
      font-family: 'Syne', sans-serif;
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .pricing-desc {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }

    .pricing-price {
      display: flex;
      align-items: baseline;
      gap: 4px;
      margin-bottom: 32px;
    }

    .pricing-currency {
      font-size: 24px;
      color: var(--text-secondary);
    }

    .pricing-amount {
      font-family: 'Space Mono', monospace;
      font-size: 56px;
      font-weight: 700;
      line-height: 1;
    }

    .pricing-period {
      font-size: 16px;
      color: var(--text-muted);
    }

    .pricing-features {
      list-style: none;
      margin-bottom: 32px;
    }

    .pricing-features li {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 0;
      font-size: 15px;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border-subtle);
    }

    .pricing-features li:last-child {
      border-bottom: none;
    }

    .pricing-features .check {
      color: var(--accent-tertiary);
      font-size: 18px;
    }

    /* ===== AUTH PAGES ===== */
    .auth-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }

    .auth-card {
      width: 100%;
      max-width: 440px;
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 20px;
      padding: 48px;
    }

    .auth-header {
      text-align: center;
      margin-bottom: 40px;
    }

    .auth-header h2 {
      font-family: 'Syne', sans-serif;
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .auth-header p {
      color: var(--text-secondary);
      font-size: 15px;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-medium);
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      color: var(--text-primary);
      transition: all 0.2s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--glow-primary);
    }

    .form-input::placeholder {
      color: var(--text-muted);
    }

    .form-hint {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .form-error {
      font-size: 13px;
      color: var(--accent-danger);
      margin-top: 6px;
    }

    .auth-divider {
      display: flex;
      align-items: center;
      gap: 16px;
      margin: 32px 0;
    }

    .auth-divider::before,
    .auth-divider::after {
      content: '';
      flex: 1;
      height: 1px;
      background: var(--border-subtle);
    }

    .auth-divider span {
      font-size: 13px;
      color: var(--text-muted);
    }

    .auth-footer {
      text-align: center;
      margin-top: 32px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .auth-footer a {
      color: var(--accent-primary);
      text-decoration: none;
      font-weight: 600;
    }

    .auth-footer a:hover {
      text-decoration: underline;
    }

    /* ===== DASHBOARD ===== */
    .dashboard {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 260px;
      background: var(--bg-surface);
      border-right: 1px solid var(--border-subtle);
      padding: 24px;
      display: flex;
      flex-direction: column;
      position: fixed;
      top: 0;
      left: 0;
      bottom: 0;
      z-index: 50;
    }

    .sidebar-logo {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 40px;
      text-decoration: none;
    }

    .sidebar-nav {
      flex: 1;
    }

    .sidebar-section {
      margin-bottom: 32px;
    }

    .sidebar-section-title {
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      color: var(--text-muted);
      margin-bottom: 12px;
      padding-left: 12px;
    }

    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      text-decoration: none;
      transition: all 0.2s;
      cursor: pointer;
      margin-bottom: 4px;
    }

    .sidebar-link:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .sidebar-link.active {
      background: var(--bg-elevated);
      color: var(--accent-primary);
    }

    .sidebar-link-icon {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    .sidebar-user {
      padding: 16px;
      background: var(--bg-elevated);
      border-radius: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .sidebar-user-avatar {
      width: 40px;
      height: 40px;
      background: var(--gradient-primary);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 16px;
      color: var(--bg-void);
    }

    .sidebar-user-info {
      flex: 1;
      min-width: 0;
    }

    .sidebar-user-name {
      font-weight: 600;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .sidebar-user-plan {
      font-size: 12px;
      color: var(--text-muted);
    }

    .main-content {
      flex: 1;
      margin-left: 260px;
      padding: 32px 40px;
      padding-top: 100px;
    }

    .dashboard-view {
      display: none;
    }

    .dashboard-view.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    .page-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 32px;
      padding-top: 16px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .page-title {
      font-family: 'Syne', sans-serif;
      font-size: 28px;
      font-weight: 700;
    }

    .page-subtitle {
      font-size: 14px;
      color: var(--text-secondary);
      margin-top: 4px;
    }

    /* Stats Cards */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      padding: 24px;
    }

    .stat-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .stat-card-icon {
      width: 40px;
      height: 40px;
      background: var(--bg-elevated);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .stat-card-trend {
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 100px;
    }

    .stat-card-trend.up {
      background: rgba(16, 185, 129, 0.1);
      color: var(--accent-tertiary);
    }

    .stat-card-trend.down {
      background: rgba(239, 68, 68, 0.1);
      color: var(--accent-danger);
    }

    .stat-card-value {
      font-family: 'Space Mono', monospace;
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-card-label {
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* Cards & Panels */
    .panel {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 16px;
      overflow: hidden;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .panel-title {
      font-family: 'Syne', sans-serif;
      font-size: 18px;
      font-weight: 600;
    }

    .panel-body {
      padding: 24px;
    }

    /* Scraping Controls */
    .scrape-controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }

    .select-wrapper {
      position: relative;
    }

    .form-select {
      width: 100%;
      padding: 14px 44px 14px 16px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-medium);
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      color: var(--text-primary);
      appearance: none;
      cursor: pointer;
      transition: all 0.2s;
    }

    .form-select:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--glow-primary);
    }

    .select-wrapper::after {
      content: '\25BC';
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 10px;
      color: var(--text-muted);
      pointer-events: none;
    }

    /* Tags Input */
    .tags-input-wrapper {
      background: var(--bg-elevated);
      border: 1px solid var(--border-medium);
      border-radius: 10px;
      padding: 8px 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      min-height: 50px;
      align-items: center;
      transition: all 0.2s;
    }

    .tags-input-wrapper:focus-within {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 3px var(--glow-primary);
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: var(--bg-surface);
      border: 1px solid var(--border-medium);
      border-radius: 6px;
      font-size: 13px;
    }

    .tag.scraped {
      background: rgba(16, 185, 129, 0.1);
      border-color: var(--accent-tertiary);
      color: var(--accent-tertiary);
    }

    .tag-remove {
      cursor: pointer;
      opacity: 0.6;
      transition: opacity 0.2s;
    }

    .tag-remove:hover {
      opacity: 1;
    }

    .tags-input {
      flex: 1;
      min-width: 120px;
      background: transparent;
      border: none;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      color: var(--text-primary);
      outline: none;
    }

    .tags-input::placeholder {
      color: var(--text-muted);
    }

    /* Progress */
    .progress-container {
      margin-top: 24px;
      display: none;
    }

    .progress-container.active {
      display: block;
    }

    .progress-bar-wrapper {
      height: 8px;
      background: var(--bg-elevated);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .progress-bar {
      height: 100%;
      background: var(--gradient-primary);
      width: 0%;
      transition: width 0.3s;
      border-radius: 4px;
    }

    .progress-text {
      font-family: 'Space Mono', monospace;
      font-size: 13px;
      color: var(--text-secondary);
    }

    /* Table */
    .table-wrapper {
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th {
      text-align: left;
      padding: 14px 20px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      background: var(--bg-elevated);
      border-bottom: 1px solid var(--border-subtle);
    }

    .data-table td {
      padding: 16px 20px;
      font-size: 14px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .data-table tr:last-child td {
      border-bottom: none;
    }

    .data-table tr:hover td {
      background: rgba(0, 229, 255, 0.02);
    }

    /* Badge */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 100px;
      font-size: 12px;
      font-weight: 600;
    }

    .badge-success {
      background: rgba(16, 185, 129, 0.1);
      color: var(--accent-tertiary);
    }

    .badge-warning {
      background: rgba(245, 158, 11, 0.1);
      color: var(--accent-warning);
    }

    .badge-danger {
      background: rgba(239, 68, 68, 0.1);
      color: var(--accent-danger);
    }

    .badge-info {
      background: rgba(0, 229, 255, 0.1);
      color: var(--accent-primary);
    }

    .badge-neutral {
      background: rgba(136, 136, 160, 0.1);
      color: var(--text-secondary);
    }

    /* Settings */
    .settings-section {
      margin-bottom: 40px;
    }

    .settings-section-title {
      font-family: 'Syne', sans-serif;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border-subtle);
    }

    .settings-row {
      display: flex;
      align-items: flex-start;
      gap: 40px;
      margin-bottom: 24px;
    }

    .settings-label-col {
      width: 280px;
      flex-shrink: 0;
    }

    .settings-label {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .settings-hint {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .settings-input-col {
      flex: 1;
    }

    /* API Key Input */
    .api-key-input {
      display: flex;
      gap: 12px;
    }

    .api-key-input .form-input {
      flex: 1;
      font-family: 'Space Mono', monospace;
      font-size: 14px;
    }

    /* Toggle */
    .toggle {
      position: relative;
      width: 48px;
      height: 26px;
    }

    .toggle input {
      display: none;
    }

    .toggle-slider {
      position: absolute;
      inset: 0;
      background: var(--bg-elevated);
      border: 1px solid var(--border-medium);
      border-radius: 100px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .toggle-slider::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: var(--text-secondary);
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.2s;
    }

    .toggle input:checked + .toggle-slider {
      background: var(--accent-primary);
      border-color: var(--accent-primary);
    }

    .toggle input:checked + .toggle-slider::before {
      background: var(--bg-void);
      transform: translateX(22px);
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 40px;
    }

    .empty-state-icon {
      width: 80px;
      height: 80px;
      margin: 0 auto 24px;
      background: var(--bg-elevated);
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
    }

    .empty-state-title {
      font-family: 'Syne', sans-serif;
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .empty-state-text {
      color: var(--text-secondary);
      font-size: 15px;
      max-width: 400px;
      margin: 0 auto;
    }

    /* Toast Notifications */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .toast {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 20px;
      background: var(--bg-surface);
      border: 1px solid var(--border-medium);
      border-radius: 12px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .toast-icon {
      font-size: 20px;
    }

    .toast-success .toast-icon { color: var(--accent-tertiary); }
    .toast-error .toast-icon { color: var(--accent-danger); }
    .toast-info .toast-icon { color: var(--accent-primary); }

    .toast-message {
      font-size: 14px;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .stats-row {
        grid-template-columns: repeat(2, 1fr);
      }
      .features-grid,
      .pricing-grid {
        grid-template-columns: 1fr;
        max-width: 500px;
        margin: 0 auto;
      }
      .pricing-card.featured {
        transform: none;
      }
    }

    @media (max-width: 900px) {
      .nav {
        padding: 16px 24px;
      }
      .nav-links {
        display: none;
      }
      .hero {
        padding: 120px 24px 60px;
      }
      .hero-stats {
        flex-direction: column;
        gap: 32px;
      }
      .sidebar {
        transform: translateX(-100%);
      }
      .sidebar.open {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
        padding: 24px;
        padding-top: 100px;
      }
      .page-header {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
      }
      .page-header > div:last-child {
        flex-wrap: wrap;
      }
      .scrape-controls {
        grid-template-columns: 1fr;
      }
      .settings-row {
        flex-direction: column;
        gap: 12px;
      }
      .settings-label-col {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="neural-grid"></div>
  <div class="particles" id="particles"></div>

  <!-- ===== NAVIGATION ===== -->
  <nav class="nav" id="mainNav">
    <a href="#" class="logo" onclick="showPage('landing')">
      <div class="logo-mark">LF</div>
      <span class="logo-text">LeadForge</span>
    </a>
    <div class="nav-links">
      <a class="nav-link" onclick="scrollToSection('features')">Features</a>
      <a class="nav-link" onclick="scrollToSection('pricing')">Pricing</a>
      <a class="nav-link" href="#">Documentation</a>
    </div>
    <div class="nav-actions" id="navActions">
      <button class="btn btn-ghost" onclick="showPage('login')">Sign In</button>
      <button class="btn btn-primary" onclick="showPage('register')">Get Started</button>
    </div>
  </nav>

  <!-- ===== LANDING PAGE ===== -->
  <div class="page active" id="page-landing">
    <section class="hero">
      <div class="hero-badge">
        <span class="hero-badge-dot"></span>
        <span>AI-Powered Lead Generation</span>
      </div>
      <h1>
        Turn Any Market Into<br>
        <span class="gradient">Qualified Leads</span>
      </h1>
      <p class="hero-subtitle">
        LeadForge uses advanced AI agents to scrape, verify, and enrich business leads from any industry and location. Sync directly to GoHighLevel in seconds.
      </p>
      <div class="hero-cta">
        <button class="btn btn-primary btn-lg" onclick="showPage('register')">
          Start Free Trial
        </button>
        <button class="btn btn-outline btn-lg" onclick="scrollToSection('features')">
          See How It Works
        </button>
      </div>
      <div class="hero-stats">
        <div class="hero-stat">
          <div class="hero-stat-value">2.5M+</div>
          <div class="hero-stat-label">Leads Generated</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-value">15K+</div>
          <div class="hero-stat-label">Active Users</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-value">98%</div>
          <div class="hero-stat-label">Email Accuracy</div>
        </div>
        <div class="hero-stat">
          <div class="hero-stat-value">50+</div>
          <div class="hero-stat-label">Industries</div>
        </div>
      </div>
    </section>

    <section class="features" id="features">
      <div class="section-header">
        <div class="section-label">Features</div>
        <h2 class="section-title">Everything You Need to Scale</h2>
        <p class="section-subtitle">Built for agencies and businesses who want predictable, high-quality leads.</p>
      </div>
      <div class="features-grid">
        <div class="feature-card">
          <div class="feature-icon">&#x1F916;</div>
          <h3>AI-Powered Scraping</h3>
          <p>Our intelligent agents search Google Maps, Yelp, and industry directories to find businesses matching your exact criteria.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#x2705;</div>
          <h3>Email Verification</h3>
          <p>Every lead is verified in real-time. No more bounced emails or wasted outreach efforts.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#x1F517;</div>
          <h3>GHL Integration</h3>
          <p>One-click sync to your GoHighLevel account. Leads flow directly into your pipelines and workflows.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#x1F4CA;</div>
          <h3>Smart Deduplication</h3>
          <p>Never scrape the same lead twice. Our system tracks every city and industry combination you've searched.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#x1F680;</div>
          <h3>Bulk Operations</h3>
          <p>Scrape hundreds of cities at once. Queue jobs and let the AI work while you focus on closing deals.</p>
        </div>
        <div class="feature-card">
          <div class="feature-icon">&#x1F512;</div>
          <h3>GDPR Compliant</h3>
          <p>We only collect publicly available business information. Stay compliant while scaling your outreach.</p>
        </div>
      </div>
    </section>

    <section class="pricing" id="pricing">
      <div class="section-header">
        <div class="section-label">Pricing</div>
        <h2 class="section-title">Simple, Transparent Pricing</h2>
        <p class="section-subtitle">Start free. Scale when you're ready.</p>
      </div>
      <div class="pricing-grid">
        <div class="pricing-card">
          <div class="pricing-name">Basic</div>
          <div class="pricing-desc">Perfect for getting started</div>
          <div class="pricing-price">
            <span class="pricing-currency">$</span>
            <span class="pricing-amount">29</span>
            <span class="pricing-period">/month</span>
          </div>
          <ul class="pricing-features">
            <li><span class="check">&#x2713;</span> 500 leads/month</li>
            <li><span class="check">&#x2713;</span> GHL sync</li>
            <li><span class="check">&#x2713;</span> CSV export</li>
            <li><span class="check">&#x2713;</span> Email support</li>
          </ul>
          <button class="btn btn-outline" style="width: 100%;" onclick="showPage('register')">Start Free Trial</button>
        </div>
        <div class="pricing-card featured">
          <div class="pricing-name">Advanced</div>
          <div class="pricing-desc">For growing businesses</div>
          <div class="pricing-price">
            <span class="pricing-currency">$</span>
            <span class="pricing-amount">79</span>
            <span class="pricing-period">/month</span>
          </div>
          <ul class="pricing-features">
            <li><span class="check">&#x2713;</span> 2,500 leads/month</li>
            <li><span class="check">&#x2713;</span> Everything in Basic</li>
            <li><span class="check">&#x2713;</span> Priority support</li>
            <li><span class="check">&#x2713;</span> Email verification</li>
            <li><span class="check">&#x2713;</span> Webhook notifications</li>
          </ul>
          <button class="btn btn-primary" style="width: 100%;" onclick="showPage('register')">Start Free Trial</button>
        </div>
        <div class="pricing-card">
          <div class="pricing-name">Premium</div>
          <div class="pricing-desc">For larger teams</div>
          <div class="pricing-price">
            <span class="pricing-currency">$</span>
            <span class="pricing-amount">149</span>
            <span class="pricing-period">/month</span>
          </div>
          <ul class="pricing-features">
            <li><span class="check">&#x2713;</span> 10,000 leads/month</li>
            <li><span class="check">&#x2713;</span> Everything in Advanced</li>
            <li><span class="check">&#x2713;</span> API access</li>
            <li><span class="check">&#x2713;</span> Custom webhooks</li>
            <li><span class="check">&#x2713;</span> Bulk operations</li>
          </ul>
          <button class="btn btn-outline" style="width: 100%;" onclick="showPage('register')">Start Free Trial</button>
        </div>
        <div class="pricing-card">
          <div class="pricing-name">Enterprise</div>
          <div class="pricing-desc">For agencies</div>
          <div class="pricing-price">
            <span class="pricing-currency">$</span>
            <span class="pricing-amount">297</span>
            <span class="pricing-period">/month</span>
          </div>
          <ul class="pricing-features">
            <li><span class="check">&#x2713;</span> Unlimited leads</li>
            <li><span class="check">&#x2713;</span> Everything in Premium</li>
            <li><span class="check">&#x2713;</span> White-label exports</li>
            <li><span class="check">&#x2713;</span> Dedicated support</li>
            <li><span class="check">&#x2713;</span> Custom integrations</li>
          </ul>
          <button class="btn btn-outline" style="width: 100%;" onclick="showPage('register')">Contact Sales</button>
        </div>
      </div>
    </section>
  </div>

  <!-- ===== LOGIN PAGE ===== -->
  <div class="page" id="page-login">
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <div class="logo" style="justify-content: center; margin-bottom: 24px;">
            <div class="logo-mark">LF</div>
          </div>
          <h2>Welcome back</h2>
          <p>Sign in to access your dashboard</p>
        </div>
        <form id="loginForm" onsubmit="handleLogin(event)">
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="loginEmail" placeholder="you@company.com" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password" required>
          </div>
          <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;" id="loginBtn">
            Sign In
          </button>
        </form>
        <div class="auth-footer">
          Don't have an account? <a href="#" onclick="showPage('register')">Sign up</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== REGISTER PAGE ===== -->
  <div class="page" id="page-register">
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <div class="logo" style="justify-content: center; margin-bottom: 24px;">
            <div class="logo-mark">LF</div>
          </div>
          <h2>Create your account</h2>
          <p>Start your 14-day free trial</p>
        </div>
        <form id="registerForm" onsubmit="handleRegister(event)">
          <div class="form-group">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-input" id="registerName" placeholder="John Doe" required>
          </div>
          <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" class="form-input" id="registerEmail" placeholder="you@company.com" required>
          </div>
          <div class="form-group">
            <label class="form-label">Password</label>
            <input type="password" class="form-input" id="registerPassword" placeholder="Create a password" required minlength="8">
            <p class="form-hint">Must be at least 8 characters</p>
          </div>
          <button type="submit" class="btn btn-primary btn-lg" style="width: 100%;" id="registerBtn">
            Create Account
          </button>
        </form>
        <div class="auth-footer">
          Already have an account? <a href="#" onclick="showPage('login')">Sign in</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== DASHBOARD ===== -->
  <div class="page" id="page-dashboard">
    <div class="dashboard">
      <aside class="sidebar" id="sidebar">
        <a href="#" class="sidebar-logo" onclick="showPage('landing')">
          <div class="logo-mark">LF</div>
          <span class="logo-text">LeadForge</span>
        </a>
        <nav class="sidebar-nav">
          <div class="sidebar-section">
            <div class="sidebar-section-title">Main</div>
            <a class="sidebar-link active" data-view="overview" onclick="showDashboardView('overview')">
              <span class="sidebar-link-icon">&#x1F4CA;</span>
              <span>Overview</span>
            </a>
            <a class="sidebar-link" data-view="scrape" onclick="showDashboardView('scrape')">
              <span class="sidebar-link-icon">&#x1F50D;</span>
              <span>Scrape Leads</span>
            </a>
            <a class="sidebar-link" data-view="leads" onclick="showDashboardView('leads')">
              <span class="sidebar-link-icon">&#x1F465;</span>
              <span>My Leads</span>
            </a>
          </div>
          <div class="sidebar-section">
            <div class="sidebar-section-title">Integrations</div>
            <a class="sidebar-link" data-view="ghl" onclick="showDashboardView('ghl')">
              <span class="sidebar-link-icon">&#x1F517;</span>
              <span>GoHighLevel</span>
            </a>
          </div>
          <div class="sidebar-section">
            <div class="sidebar-section-title">Account</div>
            <a class="sidebar-link" data-view="settings" onclick="showDashboardView('settings')">
              <span class="sidebar-link-icon">&#x2699;</span>
              <span>Settings</span>
            </a>
            <a class="sidebar-link" data-view="billing" onclick="showDashboardView('billing')">
              <span class="sidebar-link-icon">&#x1F4B3;</span>
              <span>Billing</span>
            </a>
          </div>
        </nav>
        <div class="sidebar-user">
          <div class="sidebar-user-avatar" id="userAvatar">B</div>
          <div class="sidebar-user-info">
            <div class="sidebar-user-name" id="userName">Ben</div>
            <div class="sidebar-user-plan">Professional Plan</div>
          </div>
        </div>
      </aside>

      <main class="main-content">
        <!-- Overview View -->
        <div class="dashboard-view active" id="view-overview">
          <div class="page-header">
            <div>
              <h1 class="page-title">Dashboard</h1>
              <p class="page-subtitle">Welcome back! Here's your lead generation overview.</p>
            </div>
            <button class="btn btn-primary" onclick="showDashboardView('scrape')">
              <span>&#x2795;</span> New Scrape
            </button>
          </div>

          <div class="stats-row">
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon">&#x1F465;</div>
                <span class="stat-card-trend up">+12%</span>
              </div>
              <div class="stat-card-value" id="statTotalLeads">0</div>
              <div class="stat-card-label">Total Leads</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon">&#x1F3D9;</div>
              </div>
              <div class="stat-card-value" id="statCitiesScraped">0</div>
              <div class="stat-card-label">Cities Scraped</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon">&#x2705;</div>
              </div>
              <div class="stat-card-value" id="statVerifiedEmails">0</div>
              <div class="stat-card-label">Verified Emails</div>
            </div>
            <div class="stat-card">
              <div class="stat-card-header">
                <div class="stat-card-icon">&#x1F504;</div>
              </div>
              <div class="stat-card-value" id="statGhlSynced">0</div>
              <div class="stat-card-label">Synced to GHL</div>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
            <div class="panel">
              <div class="panel-header">
                <h3 class="panel-title">Recent Activity</h3>
              </div>
              <div class="panel-body" id="recentActivity">
                <div class="empty-state">
                  <div class="empty-state-icon">&#x1F4C8;</div>
                  <div class="empty-state-title">No activity yet</div>
                  <div class="empty-state-text">Start scraping leads to see your activity here</div>
                </div>
              </div>
            </div>

            <div class="panel">
              <div class="panel-header">
                <h3 class="panel-title">Top Industries</h3>
              </div>
              <div class="panel-body" id="topIndustries">
                <div class="empty-state">
                  <div class="empty-state-icon">&#x1F3ED;</div>
                  <div class="empty-state-title">No data yet</div>
                  <div class="empty-state-text">Scrape leads to see industry breakdown</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Scrape View -->
        <div class="dashboard-view" id="view-scrape">
          <div class="page-header">
            <div>
              <h1 class="page-title">Scrape Leads</h1>
              <p class="page-subtitle">Find high-quality leads from any industry and location</p>
            </div>
          </div>

          <div class="panel">
            <div class="panel-header">
              <h3 class="panel-title">Configure Your Search</h3>
            </div>
            <div class="panel-body">
              <div class="scrape-controls">
                <div class="form-group">
                  <label class="form-label">Industry</label>
                  <div class="select-wrapper">
                    <select class="form-select" id="scrapeIndustry">
                      <option value="">Select an industry...</option>
                      <option value="dentist">Dentists</option>
                      <option value="lawyer">Lawyers</option>
                      <option value="doctor">Doctors</option>
                      <option value="chiropractor">Chiropractors</option>
                      <option value="plumber">Plumbers</option>
                      <option value="electrician">Electricians</option>
                      <option value="hvac">HVAC Companies</option>
                      <option value="roofing">Roofing Companies</option>
                      <option value="restaurant">Restaurants</option>
                      <option value="gym">Gyms & Fitness</option>
                      <option value="realtor">Real Estate Agents</option>
                      <option value="accountant">Accountants</option>
                      <option value="salon">Hair Salons</option>
                      <option value="spa">Spas & Wellness</option>
                      <option value="veterinarian">Veterinarians</option>
                      <option value="auto_repair">Auto Repair Shops</option>
                      <option value="insurance">Insurance Agents</option>
                      <option value="landscaping">Landscaping</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Max Results Per City</label>
                  <div class="select-wrapper">
                    <select class="form-select" id="scrapeMaxResults">
                      <option value="25">25 results</option>
                      <option value="50" selected>50 results</option>
                      <option value="100">100 results</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Cities (Press Enter to add)</label>
                <div class="tags-input-wrapper" id="cityTagsWrapper">
                  <input type="text" class="tags-input" id="cityInput" placeholder="e.g., Austin, TX">
                </div>
                <p class="form-hint">Add multiple cities to scrape in batch. Previously scraped cities will be highlighted.</p>
              </div>

              <button class="btn btn-primary btn-lg" id="startScrapeBtn" onclick="startScrape()" disabled>
                <span>&#x1F50D;</span> Start Scraping
              </button>

              <div class="progress-container" id="scrapeProgress">
                <div class="progress-bar-wrapper">
                  <div class="progress-bar" id="scrapeProgressBar"></div>
                </div>
                <div class="progress-text" id="scrapeProgressText">Initializing...</div>
              </div>
            </div>
          </div>

          <div class="panel" style="margin-top: 24px;">
            <div class="panel-header">
              <h3 class="panel-title">Scrape Results</h3>
              <div style="display: flex; gap: 12px;">
                <button class="btn btn-secondary btn-sm" id="exportCsvBtn" onclick="exportToCsv()" disabled>
                  Export CSV
                </button>
                <button class="btn btn-primary btn-sm" id="syncGhlBtn" onclick="syncToGhl()" disabled>
                  Sync to GHL
                </button>
              </div>
            </div>
            <div class="panel-body" id="scrapeResults">
              <div class="empty-state">
                <div class="empty-state-icon">&#x1F50E;</div>
                <div class="empty-state-title">No results yet</div>
                <div class="empty-state-text">Configure your search above and click "Start Scraping"</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Leads View -->
        <div class="dashboard-view" id="view-leads">
          <div class="page-header">
            <div>
              <h1 class="page-title">My Leads</h1>
              <p class="page-subtitle">View and manage all your scraped leads</p>
            </div>
            <div style="display: flex; gap: 12px;">
              <button class="btn btn-secondary" onclick="exportAllLeadsToCsv()">
                <span>&#x1F4E5;</span> Export All
              </button>
              <button class="btn btn-secondary" onclick="scrapeAllEmails()" id="scrapeAllEmailsBtn">
                <span>&#x1F4E7;</span> Scrape All Emails
              </button>
              <button class="btn btn-primary" onclick="syncAllToGhl()">
                <span>&#x1F504;</span> Sync All to GHL
              </button>
            </div>
          </div>

          <div class="panel">
            <div class="panel-body" id="allLeads">
              <div class="empty-state">
                <div class="empty-state-icon">&#x1F4C2;</div>
                <div class="empty-state-title">No leads yet</div>
                <div class="empty-state-text">Your scraped leads will appear here</div>
              </div>
            </div>
          </div>
        </div>

        <!-- GHL Integration View -->
        <div class="dashboard-view" id="view-ghl">
          <div class="page-header">
            <div>
              <h1 class="page-title">GoHighLevel Integration</h1>
              <p class="page-subtitle">Connect your GHL account to sync leads automatically</p>
            </div>
          </div>

          <div class="panel">
            <div class="panel-body">
              <div class="settings-section">
                <div class="settings-section-title">API Configuration</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">GHL API Key</div>
                    <div class="settings-hint">Enter your GoHighLevel API key to enable lead syncing. You can find this in your GHL settings under API Keys.</div>
                  </div>
                  <div class="settings-input-col">
                    <div class="api-key-input">
                      <input type="password" class="form-input" id="ghlApiKey" placeholder="eyJhbGciOiJIUzI1NiIs...">
                      <button class="btn btn-secondary" onclick="saveGhlKey()">Save</button>
                    </div>
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Location ID</div>
                    <div class="settings-hint">Your GHL Location ID determines where leads will be synced.</div>
                  </div>
                  <div class="settings-input-col">
                    <div class="api-key-input">
                      <input type="text" class="form-input" id="ghlLocationId" placeholder="fl5rL3eZQWBq2GYlDPkl">
                      <button class="btn btn-secondary" onclick="saveGhlLocation()">Save</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Sync Settings</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Auto-sync new leads</div>
                    <div class="settings-hint">Automatically sync leads to GHL when scraping completes</div>
                  </div>
                  <div class="settings-input-col">
                    <label class="toggle">
                      <input type="checkbox" id="ghlAutoSync">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Default Pipeline</div>
                    <div class="settings-hint">Select the pipeline where new leads will be added</div>
                  </div>
                  <div class="settings-input-col">
                    <div class="select-wrapper">
                      <select class="form-select" id="ghlPipeline">
                        <option value="">Connect GHL first...</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Industry-Specific Pipelines</div>
                <div class="settings-hint" style="margin-bottom: 16px;">Configure different pipelines for each industry. Leads will be routed to the appropriate pipeline when synced.</div>

                <div id="industryPipelinesContainer">
                  <!-- Industry pipeline rows will be added dynamically -->
                </div>

                <div style="margin-top: 16px;">
                  <button class="btn btn-secondary btn-sm" onclick="addIndustryPipeline()">
                    + Add Industry Pipeline
                  </button>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Connection Status</div>
                <div id="ghlStatus" style="display: flex; align-items: center; gap: 12px;">
                  <span class="badge badge-warning">Not Connected</span>
                  <span style="color: var(--text-secondary); font-size: 14px;">Enter your API key to connect</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings View -->
        <div class="dashboard-view" id="view-settings">
          <div class="page-header">
            <div>
              <h1 class="page-title">Settings</h1>
              <p class="page-subtitle">Manage your account preferences and integrations</p>
            </div>
          </div>

          <div class="panel">
            <div class="panel-body">
              <div class="settings-section">
                <div class="settings-section-title">Profile</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Full Name</div>
                  </div>
                  <div class="settings-input-col">
                    <input type="text" class="form-input" id="settingsName" placeholder="Your name">
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Company</div>
                  </div>
                  <div class="settings-input-col">
                    <input type="text" class="form-input" id="settingsCompany" placeholder="Your company">
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Email</div>
                  </div>
                  <div class="settings-input-col">
                    <input type="email" class="form-input" id="settingsEmail" disabled>
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col"></div>
                  <div class="settings-input-col">
                    <button class="btn btn-primary" onclick="saveProfile()">Save Profile</button>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Email Integration (Resend)</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Resend API Key</div>
                    <div class="settings-hint">Connect Resend to send email campaigns to your leads. Get your API key at <a href="https://resend.com" target="_blank" style="color: var(--accent-primary);">resend.com</a></div>
                  </div>
                  <div class="settings-input-col">
                    <div class="api-key-input">
                      <input type="password" class="form-input" id="resendApiKey" placeholder="re_xxxxxxxxxxxx">
                      <button class="btn btn-secondary" onclick="saveResendKey()">Save</button>
                    </div>
                  </div>
                </div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Connection Status</div>
                  </div>
                  <div class="settings-input-col">
                    <div id="resendStatus" style="display: flex; align-items: center; gap: 12px;">
                      <span class="badge badge-warning">Not Connected</span>
                      <span style="color: var(--text-secondary); font-size: 14px;">Enter your API key to connect</span>
                    </div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Webhooks</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Webhook URL</div>
                    <div class="settings-hint">Receive real-time notifications when new leads are scraped</div>
                  </div>
                  <div class="settings-input-col">
                    <div class="api-key-input">
                      <input type="url" class="form-input" id="webhookUrl" placeholder="https://your-webhook-url.com/endpoint">
                      <button class="btn btn-secondary" onclick="saveWebhookUrl()">Save</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Security</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Change Password</div>
                  </div>
                  <div class="settings-input-col">
                    <button class="btn btn-secondary">Update Password</button>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Danger Zone</div>
                <div class="settings-row">
                  <div class="settings-label-col">
                    <div class="settings-label">Delete Account</div>
                    <div class="settings-hint">Permanently delete your account and all associated data</div>
                  </div>
                  <div class="settings-input-col">
                    <button class="btn btn-outline" style="border-color: var(--accent-danger); color: var(--accent-danger);">Delete Account</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Billing View -->
        <div class="dashboard-view" id="view-billing">
          <div class="page-header">
            <div>
              <h1 class="page-title">Billing</h1>
              <p class="page-subtitle">Manage your subscription and payment methods</p>
            </div>
          </div>

          <div class="panel">
            <div class="panel-body">
              <div class="settings-section">
                <div class="settings-section-title">Current Plan</div>
                <div id="currentPlanDisplay" style="display: flex; align-items: center; justify-content: space-between; padding: 24px; background: var(--bg-elevated); border-radius: 12px;">
                  <div>
                    <div id="planName" style="font-family: 'Syne', sans-serif; font-size: 24px; font-weight: 700; margin-bottom: 4px;">Free</div>
                    <div id="planFeatures" style="color: var(--text-secondary);">50 leads/month &bull; Limited features</div>
                  </div>
                  <div style="text-align: right;">
                    <div id="planPrice" style="font-family: 'Space Mono', monospace; font-size: 32px; font-weight: 700;">$0<span style="font-size: 16px; color: var(--text-muted);">/mo</span></div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Usage This Period</div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                  <div style="padding: 20px; background: var(--bg-elevated); border-radius: 12px;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">Leads Used</div>
                    <div style="font-family: 'Space Mono', monospace; font-size: 24px; font-weight: 700;"><span id="billingLeadsUsed">0</span> <span id="billingLeadsLimit" style="font-size: 14px; color: var(--text-muted);">/ 50</span></div>
                    <div style="height: 4px; background: var(--bg-surface); border-radius: 2px; margin-top: 12px;">
                      <div id="leadsProgressBar" style="height: 100%; width: 0%; background: var(--gradient-primary); border-radius: 2px;"></div>
                    </div>
                  </div>
                  <div style="padding: 20px; background: var(--bg-elevated); border-radius: 12px;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">GHL Syncs</div>
                    <div id="billingGhlSyncs" style="font-family: 'Space Mono', monospace; font-size: 24px; font-weight: 700;">0</div>
                  </div>
                  <div style="padding: 20px; background: var(--bg-elevated); border-radius: 12px;">
                    <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">Cities Scraped</div>
                    <div id="billingCitiesScraped" style="font-family: 'Space Mono', monospace; font-size: 24px; font-weight: 700;">0</div>
                  </div>
                </div>
              </div>

              <div class="settings-section">
                <div class="settings-section-title">Upgrade Your Plan</div>
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
                  <div style="padding: 24px; background: var(--bg-elevated); border-radius: 12px; border: 2px solid var(--accent-primary);">
                    <div style="font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700; margin-bottom: 8px;">Professional</div>
                    <div style="font-family: 'Space Mono', monospace; font-size: 28px; font-weight: 700; margin-bottom: 12px;">$97<span style="font-size: 14px; color: var(--text-muted);">/mo</span></div>
                    <ul style="list-style: none; margin-bottom: 20px; font-size: 14px; color: var(--text-secondary);">
                      <li style="padding: 6px 0;">&#x2713; 5,000 leads/month</li>
                      <li style="padding: 6px 0;">&#x2713; Unlimited cities</li>
                      <li style="padding: 6px 0;">&#x2713; GHL integration</li>
                      <li style="padding: 6px 0;">&#x2713; Priority support</li>
                    </ul>
                    <button class="btn btn-primary" style="width: 100%;" onclick="upgradePlan('professional')">Upgrade Now</button>
                  </div>
                  <div style="padding: 24px; background: var(--bg-elevated); border-radius: 12px; border: 1px solid var(--border-medium);">
                    <div style="font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 700; margin-bottom: 8px;">Enterprise</div>
                    <div style="font-family: 'Space Mono', monospace; font-size: 28px; font-weight: 700; margin-bottom: 12px;">$297<span style="font-size: 14px; color: var(--text-muted);">/mo</span></div>
                    <ul style="list-style: none; margin-bottom: 20px; font-size: 14px; color: var(--text-secondary);">
                      <li style="padding: 6px 0;">&#x2713; Unlimited leads</li>
                      <li style="padding: 6px 0;">&#x2713; API access</li>
                      <li style="padding: 6px 0;">&#x2713; White-label exports</li>
                      <li style="padding: 6px 0;">&#x2713; Dedicated support</li>
                    </ul>
                    <button class="btn btn-outline" style="width: 100%;" onclick="upgradePlan('enterprise')">Upgrade Now</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <script>
    // ===== APP STATE =====
    const state = {
      user: null,
      token: null,
      leads: [],
      scrapedCities: [],
      selectedCities: [],
      currentResults: [],
      ghlConfig: {
        apiKey: '',
        locationId: '',
        autoSync: false,
        industryPipelines: {} // { industry: pipelineId }
      }
    };

    // Common industries for pipeline mapping
    const COMMON_INDUSTRIES = [
      'Realtors', 'Real Estate Agents', 'Chiropractors', 'Plumbers',
      'HVAC', 'Electricians', 'Roofers', 'Landscapers', 'Dentists',
      'Lawyers', 'Accountants', 'Insurance Agents', 'Auto Dealers',
      'Restaurants', 'Gyms', 'Salons', 'Contractors', 'Painters',
      'Photographers', 'Wedding Planners', 'Pet Services', 'Cleaners'
    ];

    const API_BASE = '/.netlify/functions';

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', () => {
      initParticles();
      setupCityInput();
      checkAuth();
    });

    // ===== PARTICLES EFFECT =====
    function initParticles() {
      const container = document.getElementById('particles');
      for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.animationDelay = `${Math.random() * 15}s`;
        particle.style.animationDuration = `${10 + Math.random() * 10}s`;
        container.appendChild(particle);
      }
    }

    // ===== NAVIGATION =====
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.getElementById(`page-${pageId}`).classList.add('active');

      // Update nav based on auth state
      const navActions = document.getElementById('navActions');
      if (pageId === 'dashboard' && state.user) {
        navActions.innerHTML = `
          <button class="btn btn-ghost" onclick="logout()">Sign Out</button>
        `;
      } else if (pageId === 'landing') {
        navActions.innerHTML = `
          <button class="btn btn-ghost" onclick="showPage('login')">Sign In</button>
          <button class="btn btn-primary" onclick="showPage('register')">Get Started</button>
        `;
      }

      window.scrollTo(0, 0);
    }

    function showDashboardView(viewId) {
      document.querySelectorAll('.dashboard-view').forEach(v => v.classList.remove('active'));
      document.getElementById(`view-${viewId}`).classList.add('active');

      document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
      document.querySelector(`.sidebar-link[data-view="${viewId}"]`).classList.add('active');
    }

    function scrollToSection(sectionId) {
      document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
    }

    // ===== AUTH =====
    function checkAuth() {
      const token = localStorage.getItem('leadforge_token');
      const savedUser = localStorage.getItem('leadforge_user');
      if (token && savedUser) {
        state.token = token;
        state.user = JSON.parse(savedUser);
        updateUserUI();
        loadUserData();
      }
    }

    async function handleLogin(e) {
      e.preventDefault();
      const btn = document.getElementById('loginBtn');
      btn.classList.add('loading');
      btn.disabled = true;

      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      try {
        const response = await fetch(`${API_BASE}/auth-login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Login failed');
        }

        state.token = data.token;
        state.user = data.user;
        localStorage.setItem('leadforge_token', data.token);
        localStorage.setItem('leadforge_user', JSON.stringify(data.user));

        // Check trial status and show appropriate message
        if (data.user.trialExpired) {
          showToast('warning', 'Your free trial has expired. Please upgrade to continue using LeadForge.');
          showPage('billing');
        } else if (data.user.isTrialActive && data.user.trialDaysRemaining) {
          showToast('success', `Welcome back! ${data.user.trialDaysRemaining} days left in your free trial.`);
          showPage('dashboard');
        } else {
          showToast('success', 'Welcome back!');
          showPage('dashboard');
        }
        updateUserUI();
        loadUserData();
      } catch (error) {
        showToast('error', error.message);
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    async function handleRegister(e) {
      e.preventDefault();
      const btn = document.getElementById('registerBtn');
      btn.classList.add('loading');
      btn.disabled = true;

      const name = document.getElementById('registerName').value;
      const email = document.getElementById('registerEmail').value;
      const password = document.getElementById('registerPassword').value;

      try {
        const response = await fetch(`${API_BASE}/auth-register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, name })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Registration failed');
        }

        state.token = data.token;
        state.user = data.user;
        localStorage.setItem('leadforge_token', data.token);
        localStorage.setItem('leadforge_user', JSON.stringify(data.user));

        showToast('success', 'Account created! You have a 3-day free trial with 500 leads. Enjoy!');
        updateUserUI();
        showPage('dashboard');
        loadUserData();
      } catch (error) {
        showToast('error', error.message);
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    function logout() {
      state.user = null;
      state.token = null;
      localStorage.removeItem('leadforge_user');
      localStorage.removeItem('leadforge_token');
      showPage('landing');
      showToast('info', 'You have been signed out.');
    }

    function updateUserUI() {
      if (state.user) {
        document.getElementById('userName').textContent = state.user.name || state.user.email.split('@')[0];
        document.getElementById('userAvatar').textContent = (state.user.name || state.user.email).charAt(0).toUpperCase();
        document.getElementById('settingsName').value = state.user.name || '';
        document.getElementById('settingsEmail').value = state.user.email || '';

        // Update plan display in sidebar
        const planNames = { trial: 'Free Trial', free: 'Free Plan', basic: 'Basic Plan', advanced: 'Advanced Plan', premium: 'Premium Plan', enterprise: 'Enterprise Plan' };
        const sidebarPlan = document.querySelector('.sidebar-user-plan');
        if (sidebarPlan) {
          let planText = planNames[state.user.plan] || 'Free Plan';
          // Show trial days remaining
          if (state.user.plan === 'trial' && state.user.trialEndsAt) {
            const trialEnd = new Date(state.user.trialEndsAt);
            const now = new Date();
            const daysLeft = Math.ceil((trialEnd - now) / (1000 * 60 * 60 * 24));
            if (daysLeft > 0) {
              planText = `Free Trial (${daysLeft} days left)`;
            } else {
              planText = 'Trial Expired - Upgrade Now';
            }
          }
          sidebarPlan.textContent = planText;
        }

        updateBillingDisplay();
      }
    }

    // ===== DATA LOADING =====
    async function loadUserData() {
      if (!state.token) return;

      try {
        // Load dashboard stats
        const statsRes = await fetch(`${API_BASE}/get-stats`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });
        if (statsRes.ok) {
          const data = await statsRes.json();
          const stats = data.stats || {};
          document.getElementById('statTotalLeads').textContent = stats.totalLeads || 0;
          document.getElementById('statCitiesScraped').textContent = stats.citiesScraped || 0;
          document.getElementById('statVerifiedEmails').textContent = stats.syncedLeads || 0; // Using synced as verified proxy
          document.getElementById('statGhlSynced').textContent = stats.syncedLeads || 0;

          // Update user info from stats response
          if (data.user) {
            state.user = { ...state.user, ...data.user };
            localStorage.setItem('leadforge_user', JSON.stringify(state.user));
            updateUserUI();
          }

          // Render recent activity if available
          if (data.activity && data.activity.length > 0) {
            renderRecentActivity(data.activity);
          }

          // Render top industries if available
          if (data.topIndustries && data.topIndustries.length > 0) {
            renderTopIndustries(data.topIndustries);
          }
        }

        // Load scraped cities
        const citiesRes = await fetch(`${API_BASE}/get-scraped-cities`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });
        if (citiesRes.ok) {
          const citiesData = await citiesRes.json();
          state.scrapedCities = citiesData.cities || [];
        }

        // Load leads for My Leads view
        const leadsRes = await fetch(`${API_BASE}/get-leads`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });
        if (leadsRes.ok) {
          const leadsData = await leadsRes.json();
          state.leads = leadsData.leads || [];
          renderAllLeads();
        }

        // Load user settings for GHL and Resend config
        const settingsRes = await fetch(`${API_BASE}/get-settings`, {
          headers: { 'Authorization': `Bearer ${state.token}` }
        });
        if (settingsRes.ok) {
          const settings = await settingsRes.json();

          // GHL Configuration
          if (settings.hasGhlKey) {
            state.ghlConfig.apiKey = 'configured';
            state.ghlConfig.locationId = settings.ghl_location_id || '';
            state.ghlConfig.autoSync = settings.ghl_auto_sync || false;
            state.ghlConfig.pipelineId = settings.ghl_pipeline_id || '';

            // Load industry-specific pipelines (already parsed by backend)
            state.ghlConfig.industryPipelines = settings.ghl_industry_pipelines || {};

            document.getElementById('ghlApiKey').value = '';
            document.getElementById('ghlLocationId').value = state.ghlConfig.locationId;
            document.getElementById('ghlAutoSync').checked = state.ghlConfig.autoSync;
            document.getElementById('ghlStatus').innerHTML = `
              <span class="badge badge-success">Connected</span>
              <span style="color: var(--text-secondary); font-size: 14px;">Ready to sync leads</span>
            `;

            // Render industry pipelines
            renderIndustryPipelines();
          }

          // Resend Configuration
          if (settings.hasResendKey) {
            state.resendConfig = { apiKey: 'configured' };
            const resendKeyInput = document.getElementById('resendApiKey');
            if (resendKeyInput) {
              resendKeyInput.value = '';
            }
            const resendStatus = document.getElementById('resendStatus');
            if (resendStatus) {
              resendStatus.innerHTML = `
                <span class="badge badge-success">Connected</span>
                <span style="color: var(--text-secondary); font-size: 14px;">Ready to send emails</span>
              `;
            }
          }

          // Webhook URL
          if (settings.webhook_url) {
            const webhookInput = document.getElementById('webhookUrl');
            if (webhookInput) {
              webhookInput.value = settings.webhook_url;
            }
          }
        }
      } catch (err) {
        console.error('Failed to load user data:', err);
      }
    }

    function renderRecentActivity(activity) {
      const container = document.getElementById('recentActivity');
      if (!container) return;

      if (activity.length === 0) {
        container.innerHTML = '<p style="color: var(--text-muted);">No recent activity</p>';
        return;
      }

      container.innerHTML = activity.map(item => `
        <div class="activity-item" style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-subtle);">
          <span style="color: var(--text-secondary);">${new Date(item.date).toLocaleDateString()}</span>
          <span style="color: var(--accent-primary); font-weight: 600;">${item.count} leads</span>
        </div>
      `).join('');
    }

    function renderTopIndustries(industries) {
      const container = document.getElementById('topIndustries');
      if (!container) return;

      if (industries.length === 0) {
        container.innerHTML = '<p style="color: var(--text-muted);">No industry data yet</p>';
        return;
      }

      const maxCount = Math.max(...industries.map(i => parseInt(i.count)));
      container.innerHTML = industries.map(item => `
        <div class="industry-item" style="margin-bottom: 12px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
            <span style="color: var(--text-primary);">${item.industry}</span>
            <span style="color: var(--text-secondary);">${item.count}</span>
          </div>
          <div style="background: var(--bg-elevated); height: 6px; border-radius: 3px; overflow: hidden;">
            <div style="background: var(--gradient-primary); height: 100%; width: ${(parseInt(item.count) / maxCount) * 100}%;"></div>
          </div>
        </div>
      `).join('');
    }

    function renderAllLeads() {
      const container = document.getElementById('allLeads');

      if (!state.leads || state.leads.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">&#x1F4C2;</div>
            <div class="empty-state-title">No leads yet</div>
            <div class="empty-state-text">Your scraped leads will appear here</div>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Business</th>
                <th>Email</th>
                <th>Phone</th>
                <th>City</th>
                <th>Industry</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              ${state.leads.map(lead => `
                <tr data-lead-id="${lead.id}">
                  <td>
                    <strong>${lead.business_name}</strong>
                    ${lead.website ? `<br><a href="${lead.website}" target="_blank" style="font-size: 11px; color: var(--accent-primary);">Visit Website</a>` : ''}
                  </td>
                  <td id="email-cell-${lead.id}">
                    ${lead.email
                      ? `<span style="color: var(--accent-tertiary);">${lead.email}</span>`
                      : `<button class="btn-mini btn-outline" onclick="scrapeEmailForLead(${lead.id})" id="scrape-btn-${lead.id}">
                           Scrape for Email
                         </button>`
                    }
                  </td>
                  <td>${lead.phone || '-'}</td>
                  <td>${lead.city || '-'}</td>
                  <td><span class="badge badge-neutral">${lead.industry || '-'}</span></td>
                  <td id="action-cell-${lead.id}">
                    ${lead.email
                      ? (lead.ghl_synced
                          ? `<span class="badge badge-success">&#x2713; Synced</span>`
                          : `<button class="btn-mini btn-primary" onclick="startFlowForLead(${lead.id})">
                               Start Flow
                             </button>`)
                      : `<span class="badge badge-warning">Need email first</span>`
                    }
                  </td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    // Scrape email for a specific lead
    async function scrapeEmailForLead(leadId) {
      const btn = document.getElementById(`scrape-btn-${leadId}`);
      if (btn) {
        btn.innerHTML = 'Scraping...';
        btn.disabled = true;
      }

      try {
        const response = await fetch(`${API_BASE}/scrape-email`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ leadId })
        });

        const data = await response.json();

        if (data.success && data.email) {
          // Update the email cell
          const emailCell = document.getElementById(`email-cell-${leadId}`);
          emailCell.innerHTML = `<span style="color: var(--accent-tertiary);">${data.email}</span>`;

          // Update the action cell to show Start Flow button
          const actionCell = document.getElementById(`action-cell-${leadId}`);
          actionCell.innerHTML = `
            <button class="btn-mini btn-primary" onclick="startFlowForLead(${leadId})">
              Start Flow
            </button>
          `;

          // Update state
          const lead = state.leads.find(l => l.id === leadId);
          if (lead) lead.email = data.email;

          showToast('success', `Email found: ${data.email}`);
        } else {
          // Show possible emails or failure message
          if (btn) {
            btn.innerHTML = 'Scrape for Email';
            btn.disabled = false;
          }

          if (data.possibleEmails && data.possibleEmails.length > 0) {
            showToast('info', `No email found. Try: ${data.possibleEmails[0]}`);
          } else {
            showToast('warning', data.message || 'Could not find email');
          }
        }
      } catch (error) {
        if (btn) {
          btn.innerHTML = 'Scrape for Email';
          btn.disabled = false;
        }
        showToast('error', 'Failed to scrape email');
      }
    }

    // Scrape all emails for leads that don't have them
    async function scrapeAllEmails() {
      const leadsWithoutEmail = state.leads.filter(lead => !lead.email && lead.website);

      if (leadsWithoutEmail.length === 0) {
        showToast('info', 'All leads with websites already have emails scraped');
        return;
      }

      const btn = document.getElementById('scrapeAllEmailsBtn');
      const originalText = btn.innerHTML;
      btn.disabled = true;

      let scraped = 0;
      let found = 0;
      const total = leadsWithoutEmail.length;

      showToast('info', `Starting to scrape ${total} leads for emails...`);

      for (const lead of leadsWithoutEmail) {
        scraped++;
        btn.innerHTML = `<span>&#x23F3;</span> Scraping ${scraped}/${total}...`;

        try {
          const response = await fetch(`${API_BASE}/scrape-email`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${state.token}`
            },
            body: JSON.stringify({ leadId: lead.id })
          });

          const data = await response.json();

          if (data.success && data.email) {
            found++;
            lead.email = data.email;

            // Update the email cell
            const emailCell = document.getElementById(`email-cell-${lead.id}`);
            if (emailCell) {
              emailCell.innerHTML = `<span style="color: var(--accent-tertiary);">${data.email}</span>`;
            }

            // Update the action cell to show Start Flow button
            const actionCell = document.getElementById(`action-cell-${lead.id}`);
            if (actionCell) {
              actionCell.innerHTML = `
                <button class="btn-mini btn-primary" onclick="startFlowForLead(${lead.id})">
                  Start Flow
                </button>
              `;
            }
          }

          // Small delay between requests to avoid rate limiting
          await new Promise(resolve => setTimeout(resolve, 500));
        } catch (error) {
          console.error(`Error scraping email for lead ${lead.id}:`, error);
        }
      }

      btn.disabled = false;
      btn.innerHTML = originalText;

      showToast('success', `Done! Found ${found} emails out of ${total} leads scraped.`);
    }

    // Start flow for a lead (sync to GHL)
    async function startFlowForLead(leadId) {
      const actionCell = document.getElementById(`action-cell-${leadId}`);
      actionCell.innerHTML = '<span class="badge badge-neutral">Syncing...</span>';

      try {
        const response = await fetch(`${API_BASE}/ghl-sync`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ leadIds: [leadId], startFlow: true })
        });

        const data = await response.json();

        if (data.success || response.ok) {
          actionCell.innerHTML = `<span class="badge badge-success">&#x2713; Flow Started</span>`;

          // Update state
          const lead = state.leads.find(l => l.id === leadId);
          if (lead) lead.ghl_synced = true;

          showToast('success', 'Lead synced to GoHighLevel! Flow started.');
        } else {
          actionCell.innerHTML = `
            <button class="btn-mini btn-primary" onclick="startFlowForLead(${leadId})">
              Start Flow
            </button>
          `;
          showToast('error', data.error || 'Failed to start flow');
        }
      } catch (error) {
        actionCell.innerHTML = `
          <button class="btn-mini btn-primary" onclick="startFlowForLead(${leadId})">
            Start Flow
          </button>
        `;
        showToast('error', 'Failed to sync with GoHighLevel');
      }
    }

    // ===== CITY INPUT =====
    function setupCityInput() {
      const input = document.getElementById('cityInput');
      const wrapper = document.getElementById('cityTagsWrapper');

      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && input.value.trim()) {
          e.preventDefault();
          addCity(input.value.trim());
          input.value = '';
        }
      });
    }

    function addCity(city) {
      if (state.selectedCities.includes(city)) return;
      state.selectedCities.push(city);
      renderCityTags();
      updateScrapeButton();
    }

    function removeCity(city) {
      state.selectedCities = state.selectedCities.filter(c => c !== city);
      renderCityTags();
      updateScrapeButton();
    }

    function renderCityTags() {
      const wrapper = document.getElementById('cityTagsWrapper');
      const input = document.getElementById('cityInput');
      const industry = document.getElementById('scrapeIndustry').value;

      const tagsHtml = state.selectedCities.map(city => {
        const isScraped = state.scrapedCities.some(
          s => s.city.toLowerCase() === city.toLowerCase() && s.industry === industry
        );
        return `
          <div class="tag ${isScraped ? 'scraped' : ''}">
            ${city}${isScraped ? ' (done)' : ''}
            <span class="tag-remove" onclick="removeCity('${city}')">&times;</span>
          </div>
        `;
      }).join('');

      wrapper.innerHTML = tagsHtml + `<input type="text" class="tags-input" id="cityInput" placeholder="e.g., Austin, TX">`;

      // Re-setup event listener
      const newInput = document.getElementById('cityInput');
      newInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && newInput.value.trim()) {
          e.preventDefault();
          addCity(newInput.value.trim());
          newInput.value = '';
        }
      });
      newInput.focus();
    }

    function updateScrapeButton() {
      const industry = document.getElementById('scrapeIndustry').value;
      const btn = document.getElementById('startScrapeBtn');
      btn.disabled = !industry || state.selectedCities.length === 0;
    }

    // Update when industry changes
    document.addEventListener('DOMContentLoaded', () => {
      const industrySelect = document.getElementById('scrapeIndustry');
      if (industrySelect) {
        industrySelect.addEventListener('change', () => {
          renderCityTags();
          updateScrapeButton();
        });
      }

      // GHL auto-sync toggle
      const autoSyncToggle = document.getElementById('ghlAutoSync');
      if (autoSyncToggle) {
        autoSyncToggle.addEventListener('change', saveGhlAutoSync);
      }
    });

    // ===== SCRAPING =====
    async function startScrape() {
      const industry = document.getElementById('scrapeIndustry').value;
      const maxResults = parseInt(document.getElementById('scrapeMaxResults').value);
      const btn = document.getElementById('startScrapeBtn');
      const progressContainer = document.getElementById('scrapeProgress');
      const progressBar = document.getElementById('scrapeProgressBar');
      const progressText = document.getElementById('scrapeProgressText');

      if (!state.token) {
        showToast('error', 'Please log in to scrape leads');
        return;
      }

      // Filter out already scraped
      const citiesToScrape = state.selectedCities.filter(city =>
        !state.scrapedCities.some(
          s => s.city && s.city.toLowerCase() === city.toLowerCase() && s.industry === industry
        )
      );

      if (citiesToScrape.length === 0) {
        showToast('info', 'All selected cities have already been scraped for this industry.');
        return;
      }

      btn.classList.add('loading');
      btn.disabled = true;
      progressContainer.classList.add('active');
      progressBar.style.width = '10%';
      progressText.textContent = 'Initiating scrape...';

      try {
        // Trigger the scrape via API
        const response = await fetch(`${API_BASE}/trigger-scrape`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({
            cities: citiesToScrape,
            industry,
            maxResults
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Scrape failed');
        }

        progressBar.style.width = '50%';
        progressText.textContent = `Scraping ${data.citiesToScrape} cities...`;

        // Poll for results (or simulate progress)
        await simulateScrapeProgress(citiesToScrape, industry, maxResults, progressBar, progressText);

        progressBar.style.width = '100%';
        progressText.textContent = 'Complete!';

        // Reload data to get actual results
        await loadUserData();

        // Show current session results - match by city (flexible matching) and industry
        const normalizeCity = (city) => {
          if (!city) return '';
          return city.toLowerCase().split(',')[0].trim();
        };

        const scrapedCityNames = citiesToScrape.map(c => normalizeCity(c));

        state.currentResults = state.leads.filter(l => {
          const leadCity = normalizeCity(l.city);
          const cityMatch = scrapedCityNames.some(c => leadCity.includes(c) || c.includes(leadCity));
          const industryMatch = l.industry && l.industry.toLowerCase() === industry.toLowerCase();
          return cityMatch && industryMatch;
        });

        console.log('Scrape results:', state.currentResults.length, 'leads found for', scrapedCityNames, industry);
        renderResults();

        document.getElementById('exportCsvBtn').disabled = state.currentResults.length === 0;
        document.getElementById('syncGhlBtn').disabled = state.currentResults.length === 0;

        // Clear selected cities
        state.selectedCities = [];
        renderCityTags();

        showToast('success', `Scrape initiated! ${data.citiesToScrape} cities queued.`);

      } catch (error) {
        showToast('error', error.message);
        progressText.textContent = 'Failed';
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;

        setTimeout(() => {
          progressContainer.classList.remove('active');
        }, 3000);
      }
    }

    async function simulateScrapeProgress(cities, industry, maxResults, progressBar, progressText) {
      // Simulate progress while n8n processes in background
      for (let i = 0; i < cities.length; i++) {
        progressBar.style.width = `${50 + ((i + 1) / cities.length) * 40}%`;
        progressText.textContent = `Processing ${cities[i]}... (${i + 1}/${cities.length})`;
        await sleep(1500); // Simulate processing time
      }
    }

    function generateMockLeads(city, industry, count) {
      const leads = [];
      const businessPrefixes = ['Elite', 'Premier', 'Quality', 'Advanced', 'Pro', 'Expert', 'Best', 'Top'];
      const businessSuffixes = {
        dentist: ['Dental', 'Dentistry', 'Dental Care', 'Family Dental'],
        lawyer: ['Law Firm', 'Legal', 'Attorneys', 'Law Office'],
        plumber: ['Plumbing', 'Plumbing Co', 'Plumbing Services'],
        electrician: ['Electric', 'Electrical', 'Electric Co'],
        default: ['Services', 'Solutions', 'Group', 'Co']
      };

      for (let i = 0; i < Math.min(count, 20); i++) {
        const prefix = businessPrefixes[Math.floor(Math.random() * businessPrefixes.length)];
        const suffixes = businessSuffixes[industry] || businessSuffixes.default;
        const suffix = suffixes[Math.floor(Math.random() * suffixes.length)];

        leads.push({
          id: `lead_${Date.now()}_${i}`,
          business_name: `${prefix} ${suffix}`,
          email: `contact@${prefix.toLowerCase()}${suffix.replace(/\s/g, '').toLowerCase()}.com`,
          phone: `(${Math.floor(Math.random() * 900) + 100}) ${Math.floor(Math.random() * 900) + 100}-${Math.floor(Math.random() * 9000) + 1000}`,
          city: city,
          industry: industry,
          verified: Math.random() > 0.3,
          scraped_at: new Date().toISOString()
        });
      }
      return leads;
    }

    function renderResults() {
      const container = document.getElementById('scrapeResults');

      if (state.currentResults.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">&#x1F50E;</div>
            <div class="empty-state-title">No results yet</div>
            <div class="empty-state-text">Configure your search above and click "Start Scraping"</div>
          </div>
        `;
        return;
      }

      container.innerHTML = `
        <div class="table-wrapper">
          <table class="data-table">
            <thead>
              <tr>
                <th>Business</th>
                <th>Email</th>
                <th>Phone</th>
                <th>City</th>
                <th>Industry</th>
              </tr>
            </thead>
            <tbody>
              ${state.currentResults.map(lead => `
                <tr>
                  <td>
                    <strong>${lead.business_name}</strong>
                    ${lead.website ? `<br><a href="${lead.website}" target="_blank" style="font-size: 11px; color: var(--accent-primary);">Visit Website</a>` : ''}
                  </td>
                  <td>${lead.email ? `<span style="color: var(--accent-tertiary);">${lead.email}</span>` : '<span style="color: var(--text-muted);">-</span>'}</td>
                  <td>${lead.phone || '-'}</td>
                  <td>${lead.city || '-'}</td>
                  <td><span class="badge badge-neutral">${lead.industry || '-'}</span></td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
        <div style="margin-top: 16px; color: var(--text-secondary); font-size: 14px;">
          Found ${state.currentResults.length} leads
        </div>
      `;
    }

    // ===== EXPORT & SYNC =====
    function exportToCsv() {
      if (state.currentResults.length === 0) return;

      const headers = ['Business Name', 'Email', 'Phone', 'City', 'Industry', 'Verified', 'Scraped At'];
      const rows = state.currentResults.map(l => [
        l.business_name,
        l.email,
        l.phone,
        l.city,
        l.industry,
        l.verified ? 'Yes' : 'No',
        l.scraped_at
      ]);

      const csv = [headers, ...rows].map(r => r.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = `leadforge_export_${Date.now()}.csv`;
      a.click();

      showToast('success', 'Leads exported to CSV!');
    }

    function exportAllLeadsToCsv() {
      if (!state.leads || state.leads.length === 0) {
        showToast('info', 'No leads to export');
        return;
      }

      const headers = ['Business Name', 'Email', 'Phone', 'Address', 'City', 'State', 'Industry', 'Website', 'Rating', 'Reviews', 'GHL Synced', 'Created At'];
      const rows = state.leads.map(l => [
        `"${(l.business_name || '').replace(/"/g, '""')}"`,
        l.email || '',
        l.phone || '',
        `"${(l.address || '').replace(/"/g, '""')}"`,
        l.city || '',
        l.state || '',
        l.industry || '',
        l.website || '',
        l.rating || '',
        l.reviews || '',
        l.ghl_synced ? 'Yes' : 'No',
        l.created_at || ''
      ]);

      const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = `leadforge_all_leads_${Date.now()}.csv`;
      a.click();

      showToast('success', `${state.leads.length} leads exported to CSV!`);
    }

    async function syncAllToGhl() {
      if (!state.ghlConfig.apiKey || state.ghlConfig.apiKey === '') {
        showToast('error', 'Please configure your GHL API key first.');
        showDashboardView('ghl');
        return;
      }

      if (!state.leads || state.leads.length === 0) {
        showToast('info', 'No leads to sync');
        return;
      }

      const unsyncedLeads = state.leads.filter(l => !l.ghl_synced);
      if (unsyncedLeads.length === 0) {
        showToast('info', 'All leads are already synced to GHL');
        return;
      }

      showToast('info', `Syncing ${unsyncedLeads.length} leads to GoHighLevel...`);

      try {
        const leadIds = unsyncedLeads.map(l => l.id);
        const response = await fetch(`${API_BASE}/ghl-sync`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ leadIds })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Sync failed');
        }

        await loadUserData();
        showToast('success', `${data.syncedCount || unsyncedLeads.length} leads synced to GoHighLevel!`);
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function syncToGhl() {
      if (!state.ghlConfig.apiKey) {
        showToast('error', 'Please configure your GHL API key first.');
        showDashboardView('ghl');
        return;
      }

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      const btn = document.getElementById('syncGhlBtn');
      btn.classList.add('loading');
      btn.disabled = true;

      try {
        // Get lead IDs that haven't been synced
        const unsyncedLeads = state.currentResults.filter(l => !l.ghl_synced);
        const leadIds = unsyncedLeads.map(l => l.id);

        if (leadIds.length === 0) {
          showToast('info', 'All leads already synced to GHL');
          return;
        }

        const response = await fetch(`${API_BASE}/ghl-sync`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ leadIds })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Sync failed');
        }

        // Reload data to reflect changes
        await loadUserData();

        showToast('success', `${data.syncedCount} leads synced to GoHighLevel!`);
      } catch (error) {
        showToast('error', error.message);
      } finally {
        btn.classList.remove('loading');
        btn.disabled = false;
      }
    }

    // ===== GHL SETTINGS =====
    async function saveGhlKey() {
      const key = document.getElementById('ghlApiKey').value;
      if (!key || key.includes('')) return;

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ ghlApiKey: key })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        state.ghlConfig.apiKey = key;
        document.getElementById('ghlApiKey').value = '';
        document.getElementById('ghlStatus').innerHTML = `
          <span class="badge badge-success">Connected</span>
          <span style="color: var(--text-secondary); font-size: 14px;">Ready to sync leads</span>
        `;

        showToast('success', 'GHL API key saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function saveGhlLocation() {
      const locationId = document.getElementById('ghlLocationId').value;

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ ghlLocationId: locationId })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        state.ghlConfig.locationId = locationId;
        showToast('success', 'Location ID saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function saveGhlAutoSync() {
      const autoSync = document.getElementById('ghlAutoSync').checked;

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ ghlAutoSync: autoSync })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        state.ghlConfig.autoSync = autoSync;
        showToast('success', 'Auto-sync setting saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    // ===== INDUSTRY PIPELINE SETTINGS =====
    function renderIndustryPipelines() {
      const container = document.getElementById('industryPipelinesContainer');
      if (!container) return;

      const pipelines = state.ghlConfig.industryPipelines || {};
      const industries = Object.keys(pipelines);

      if (industries.length === 0) {
        container.innerHTML = `
          <div style="color: var(--text-muted); font-size: 14px; padding: 16px; background: var(--bg-elevated); border-radius: 8px;">
            No industry-specific pipelines configured. Click "Add Industry Pipeline" to set up routing.
          </div>
        `;
        return;
      }

      container.innerHTML = industries.map((industry, index) => `
        <div class="industry-pipeline-row" style="display: flex; gap: 12px; align-items: center; margin-bottom: 12px; padding: 12px; background: var(--bg-elevated); border-radius: 8px;">
          <div style="flex: 1;">
            <select class="form-select" id="industry-select-${index}" onchange="updateIndustryPipeline(${index}, this.value, null)" style="width: 100%;">
              <option value="">Select Industry...</option>
              ${COMMON_INDUSTRIES.map(ind => `
                <option value="${ind}" ${industry === ind ? 'selected' : ''}>${ind}</option>
              `).join('')}
              <option value="${industry}" ${!COMMON_INDUSTRIES.includes(industry) ? 'selected' : ''}>${!COMMON_INDUSTRIES.includes(industry) ? industry : ''}</option>
            </select>
          </div>
          <div style="flex: 1;">
            <input type="text" class="form-input" id="pipeline-input-${index}"
              value="${pipelines[industry] || ''}"
              placeholder="Pipeline ID"
              onchange="updateIndustryPipeline(${index}, '${industry}', this.value)"
              style="width: 100%;">
          </div>
          <button class="btn-mini btn-outline" onclick="removeIndustryPipeline('${industry}')" style="color: var(--accent-danger); border-color: var(--accent-danger);">
            Remove
          </button>
        </div>
      `).join('');
    }

    function addIndustryPipeline() {
      // Add a new empty entry
      const pipelines = state.ghlConfig.industryPipelines || {};
      const newKey = `New Industry ${Object.keys(pipelines).length + 1}`;
      pipelines[newKey] = '';
      state.ghlConfig.industryPipelines = pipelines;
      renderIndustryPipelines();
    }

    function removeIndustryPipeline(industry) {
      const pipelines = state.ghlConfig.industryPipelines || {};
      delete pipelines[industry];
      state.ghlConfig.industryPipelines = pipelines;
      saveIndustryPipelines();
      renderIndustryPipelines();
    }

    async function updateIndustryPipeline(index, industry, pipelineId) {
      const pipelines = state.ghlConfig.industryPipelines || {};
      const oldKeys = Object.keys(pipelines);
      const oldKey = oldKeys[index];

      if (industry && industry !== oldKey) {
        // Industry name changed - rename key
        const value = pipelineId !== null ? pipelineId : pipelines[oldKey];
        delete pipelines[oldKey];
        pipelines[industry] = value;
      } else if (pipelineId !== null) {
        // Pipeline ID changed
        pipelines[industry || oldKey] = pipelineId;
      }

      state.ghlConfig.industryPipelines = pipelines;
      await saveIndustryPipelines();
    }

    async function saveIndustryPipelines() {
      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({
            ghlIndustryPipelines: JSON.stringify(state.ghlConfig.industryPipelines)
          })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        showToast('success', 'Industry pipelines saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    // ===== RESEND SETTINGS =====
    async function saveResendKey() {
      const key = document.getElementById('resendApiKey').value;
      if (!key || key.includes('')) return;

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ resendApiKey: key })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        state.resendConfig = { apiKey: key };
        document.getElementById('resendApiKey').value = '';
        document.getElementById('resendStatus').innerHTML = `
          <span class="badge badge-success">Connected</span>
          <span style="color: var(--text-secondary); font-size: 14px;">Ready to send emails</span>
        `;

        showToast('success', 'Resend API key saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    async function saveWebhookUrl() {
      const url = document.getElementById('webhookUrl').value;

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ webhookUrl: url })
        });

        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'Failed to save');
        }

        showToast('success', 'Webhook URL saved!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    // ===== PROFILE SETTINGS =====
    async function saveProfile() {
      const name = document.getElementById('settingsName').value;
      const company = document.getElementById('settingsCompany')?.value || '';

      if (!state.token) {
        showToast('error', 'Please log in first');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/update-settings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({ name, company })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to save');
        }

        if (data.user) {
          state.user = { ...state.user, ...data.user };
          localStorage.setItem('leadforge_user', JSON.stringify(state.user));
          updateUserUI();
        }

        showToast('success', 'Profile updated!');
      } catch (error) {
        showToast('error', error.message);
      }
    }

    // ===== TOAST NOTIFICATIONS =====
    function showToast(type, message) {
      const container = document.getElementById('toastContainer');
      const icons = {
        success: '&#x2713;',
        error: '&#x2717;',
        info: '&#x2139;'
      };

      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <span class="toast-icon">${icons[type]}</span>
        <span class="toast-message">${message}</span>
      `;

      container.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    // ===== BILLING =====
    async function upgradePlan(planId) {
      if (!state.token || !state.user) {
        showToast('error', 'Please log in first');
        showPage('login');
        return;
      }

      showToast('info', 'Preparing checkout...');

      try {
        const response = await fetch(`${API_BASE}/create-checkout`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${state.token}`
          },
          body: JSON.stringify({
            planId,
            email: state.user.email,
            userId: state.user.id
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Failed to create checkout');
        }

        // Redirect to Airwallex hosted payment page
        if (data.checkoutUrl) {
          window.location.href = data.checkoutUrl;
        } else {
          showToast('error', 'Checkout URL not received');
        }
      } catch (error) {
        showToast('error', error.message);
      }
    }

    function updateBillingDisplay() {
      if (!state.user) return;

      const planConfig = {
        trial: { name: 'Free Trial', price: 0, features: '500 leads  3-day trial  Basic features', limit: 500 },
        free: { name: 'Free', price: 0, features: '50 leads', limit: 50 },
        basic: { name: 'Basic', price: 29, features: '500 leads/month  GHL sync  CSV export', limit: 500 },
        advanced: { name: 'Advanced', price: 79, features: '2,500 leads/month  Email verification  Priority support', limit: 2500 },
        premium: { name: 'Premium', price: 149, features: '10,000 leads/month  API access  Webhooks', limit: 10000 },
        enterprise: { name: 'Enterprise', price: 297, features: 'Unlimited leads  White-label  Dedicated support', limit: -1 }
      };

      const plan = planConfig[state.user.plan] || planConfig.trial;
      const leadsUsed = state.user.leadsUsed || 0;
      const leadsLimit = state.user.leadsLimit || plan.limit;

      document.getElementById('planName').textContent = plan.name;
      document.getElementById('planFeatures').textContent = plan.features;
      document.getElementById('planPrice').innerHTML = `$${plan.price}<span style="font-size: 16px; color: var(--text-muted);">/mo</span>`;

      document.getElementById('billingLeadsUsed').textContent = leadsUsed;
      document.getElementById('billingLeadsLimit').textContent = leadsLimit === -1 ? '/ ' : `/ ${leadsLimit}`;

      const progressPercent = leadsLimit === -1 ? 0 : Math.min((leadsUsed / leadsLimit) * 100, 100);
      document.getElementById('leadsProgressBar').style.width = `${progressPercent}%`;

      // Update from stats
      const ghlSynced = document.getElementById('statGhlSynced').textContent;
      const citiesScraped = document.getElementById('statCitiesScraped').textContent;
      document.getElementById('billingGhlSyncs').textContent = ghlSynced;
      document.getElementById('billingCitiesScraped').textContent = citiesScraped;
    }

    // ===== UTILITIES =====
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
  </script>
</body>
</html>
